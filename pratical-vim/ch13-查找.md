## Chapter 13 查找P.186

### Tip 76 结识查找命令P.186
`/`, `?`,`n`和`N`这几个命令自己已很熟悉，下面是一些新内容。

1. `<Esc>`可快速切换至普通模式；
#### 重复上一次查找 - 将查询域留空 `/<CR>`, `?<CR>`
假设我们使用`?`在文本中反向查找一个字符，并且光标已经跳到了上一处匹配，
这时我们突然改变注意，向向后查找。当然可以用`N`做到这点，
但这样做好像把一切都搞颠倒了。这个时候，
直接`/<CR>`即可用相同的模式执行一次正向查找，关键是这时`n`就代表向后，
`N`代表向前，顺序有过来了。

### Tip 80 高亮查找匹配

* 默认关闭
* 开启：`:set hls`
* **彻底**禁用：`:set nohlsearch`或 `:se nohls`或 `:se hls!`
* 优雅的方案：`:nohlsearch`, 暂时关闭，直到执行新的查找；

### Tip 81 在执行查找前预览第一处匹配`:set incsearch` P.189
`/`查找只有在按下`<CR>`后才会生效。激活增量查找后，
vim 会根据输入的字符实时将光标跳转到第一个匹配处
（如果存在的话）。`<Esc>`可以让光标复位。

####适用场景一：检查是否存在一处匹配
有时候我们只是想确认文档中是否存在某个字符串，
而不是真的要去查询、跳转，增量查询在这时可以派上用场。
####适用场景二：根据预览结果对查找域自动补全`<C-r><C-w>`P.190
比如要匹配`synchronize`这个词，启用增量查询后，
当我们只输入到`sync`就发现了这个词，这时不必将单词的剩余部分补完整，
按下`<C-r><C-w>`就能像 Bash 中一样将单词自动补全。
### Tip 82 统计当前模式的匹配个数P.191
假设我们在一个 Class 文件中通过`/function `进行了一次模式查找，
突然好奇地想知道这个 Class 中一共有多少了方法，下面一条命令可以实现：

	:%s///gn
这条命令本质上是使用了`:substitute`命令，不过里面有几点需要说明一下：

1. `%`：范围为整个文档；
2. `///`: 表示同时留空查找域和替换域。

### Tip 83 将光标偏移到查询匹配的结尾（而不是单词的结尾）`/{pattern}/e`P.191
一个现象：通过查询匹配到的字符的光标在匹配字符的**头部**而不是**尾部**。

场景：如何将下面的一段文字中的 'lang' 都替换成 'language'?

	Aim to learn a new programming lang each year.
	Which lang did you pick up last year?
	Which langs would you like to learn?
显然，`:1,3s/lang/language/g`可以完成。书中试图用点范式来完成，
并意在从中讲一些道理。

1. `/lang<CR>`记住几个需要替换字符串的位置，这时光标在首个匹配单词的头部；
2. `eauage` 补全单词，注意这里使用的一个很有用的组合命令`ea`,
它可以快速在单词末尾添加内容；
3. `ne.` 重复；

这里的陷阱是`langs`那个单词，通过点范式会将该词替换成 'langsuage'
这个错误的单词，在上面问题中如果能将光标移动到匹配字符串的尾部，
而不是整个单词的尾部就完美了。

`e`后缀就是解决这个问题的。

### Tip 84 对完整的查找匹配进行操作P.193
模式查找可以让我们在匹配内容见跳转，但有时我们也可能有对匹配进行操作的需求，
请看下面作者设计的一个场景：

	class XHTMLDocument < XmlDocument; end
	class XhtmlTag < XmlTag; end
这是一段 Ruby 代码，我们现在想将上面的`Xhtml`, `Xml` 部分都变成大写。

首先，`gU{motion}`可以实现将选定内容变成大写，但是这里的问题是既有`Xhtml`,
又有`Xml`,换句话说，长度不一样，所以我们要用正则表达式来作为查询模式，
以便能够匹配到所有内容。

1. `/\vX(ht)?ml\C<CR>` 能够达到上述目的。
2. `gU//e<CR>` 搞定地一个字符串，这串输入有很多内容值得一说：
	1. 本质上，这是一个`gU{motion}`命令，只不过这里的`{motion}`内容为`//e<CR>`
	2. 这个动作又拆解为两部分：
		1. `/<CR>`熟悉吧，留空查询域，直接使用上一次查询模式，
		这个命令的结果是将光标移动到第一处匹配的头部，即`Xhtml`中的`X`上，
		2. 查询后加上`/e`后缀前面也讲过了，将光标移至匹配的为不，
		即`Xhtml`中的`l`, 这两个命令合在一起，构成了一个范围；
	3. 综上，`gU//e<CR>`的作用就是将匹配字符全部大写；
3. 这时本应该用`n`跳向下一处匹配并按`.`了，但是，此时的“当前模式”
已由`/\vX(ht)?ml\C<CR>`变成了 `/\vX(ht)?ml\C<CR>/e`，注意，多了个`/e`后缀，
这就导致`gU//e<CR>`运行出错，因为`gU`的动作范围出了问题。正确的方法是再执行一次
`//<CR>`,以确保查找不带偏移，这时就可以按`.`重复了。 
也就说，平常“一个按键来移动，再用`.`重复”中的一个按键在这里变成了三个按键
（`//<CR>`）。

[https://github.com/kana/vim-textobj-lastpat](https://github.com/kana/vim-textobj-lastpat)
这个插件能让上面的三个按键重新变成一个，这样我们就能用`n`来移动，用`.`来重复了。

### Tip 85 利用查找历史，迭代完成复杂的模式P.196

> 编写正则表达式是一件很难的事情，因为我们不可能一次就写对。因此接下来要做的，
> 就是总结一套顺畅的工作流程，允许我们通过迭代的方式逐步完成模式的设计工作。

本节的例子，下面一段文字中的单引号被当成了引用标记，我们想写一个正则表达式，
用它匹配每一个被引号括起来的字符串，之后使用`:substitute`来替换成正确的双引号。

	This string contains a 'quoted' word.
	This string contains 'two' quoted 'words.'
	This 'string doesn't make things easy.'
作者通过调出查找命令行窗口的方式（`q/`）来一步步修改正则表达式，
修改的过程中也使用了很多小技巧。

### Tip 86 查找当前高亮选区中的文本P.199
本节介绍了一个作者经常用的一个功能，在可视模式下通过`*`
键来实现查找选中文字的目的。自己使用`*`都是在普通模式下，
用来查找光标下的单词。这个功能作者编写了一个插件来完成。

范例：

	She sells sea shells by the sea shore.
对自己来说这个功能作用不大，因此没有仔细研究。


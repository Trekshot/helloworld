## Chapter 10 复制与粘贴
### Tip 59 用无名寄存器实现删除、复制与粘贴操作

在 Vim 中我们操作的是寄存器，不是剪切板。

1. **调换字符`xp`**
  `xp` 用来调换光标之后的两个字符，typo 中有很多都是两个字母的顺序颠倒，
要调换连个字母的顺序很简单。命令由`x`和`p`组合而成，这里要记住这个组合。
2. **调换文本行`ddp`**
调整两行间的顺序，自己好像习惯用`Vxp`,这里的方法可以少按一个按键。
3. **创建文本行副本`yyp`**

### Tip 60 深入理解 Vim 寄存器

#### 1 引用一个寄存器`"{register}`

Vim 中不止一个寄存器，上节用的都叫无名寄存器，我们可以使用`"{register}`
命令来指定寄存器，不指定的话，用的就是无名寄存器。

Vim 内置的寄存器和 Windows 下剪贴板的一个区别就是：它即使在系统重启后仍在存在，
而window下的剪贴板在重启后后没有了。

#### 2 无名寄存器`""`
`""p`=`p`. 无名寄存器中的内容是很容易被覆盖掉的。
`x`,`s`,`d{motion}`,`c{motion}`与`y{motion}`都会覆盖无名寄存器中的内容。
因此我们说无名寄存器易变的。
#### 3 复制专用寄存器`"0`
顾名思义，“复制专用寄存器”是专门提供给`y{motion}`的。当我们使用`y{motion}`
命令时，无名寄存器和复制专用寄存器中同时会保留一份备份。
接下来如果执行一条`c`命令，存储在无名寄存器中的备份将被覆盖，
而存储在复制专用寄存器中的备份则不会受到影响。
#### 4 查看寄存器中的信息`:reg [number]`
假如我们想查看复制专用寄存器中的内容，可以使用`:reg 0`。
直接输入`:reg`会显示所有寄存器中的内容。
#### 5 有名寄存器`"a - "z`
这个功能是先在优酷上的一个 Vim 视频上发现，后看到本节的内容，因此印象深刻。
学到这个功能的第一反应就是：它可以应用到 Pratical Vim 读书笔记中！
笔记中经常要写标题，每写一个新的章节都得手动`yyp`太麻烦，其实可以将 Chapter
标题存在`"a`寄存器内，Tip 标题存在`"b`内，子标题存在`"c`内，
而表格模板就存在`"d`内。这样一来，开始写新章节就`"ap`,新的 Tip 就`"bp`,
新的子标题就`"cp`,需要插入表格了就`"dp`真是太方便了！
#### 6 黑洞寄存器`"_`
黑洞寄存器是个“又去无回”的地方，有点”彻底删除“的意思。如果我们只是想删除内容，
不想覆盖无名寄存器时，这条命令很管用。
#### 7 系统剪贴板`"+`**在Debian下不能用**
前面5种寄存器都是 Vim 内部的，如果想从 Vim 中复制文本到外部应用程序（反之亦然）
，就需要用到系统剪贴板，这个外部寄存器用`"+`来表示。

该功能在 Debian 下不可用的原因很可能是 Vim 版本的问题。
P.139 讲到 X11 Clipboard 不可用的证据是
`:version`中`xterm_clipboard`前面有`-`，表示功能不可用。
另外P.147中有如下一段话：

> 如果你运行的 Vim 是已集成系统剪贴板的版本……

这两处表明很可能跟 Vim 版本有关。
#### 8 表达式寄存器`"=`
其它的寄存器都是用来存储一段文字内容，而表达式寄存器不是，它可以接受一段Vim
脚本，并将输出内容显示出来。那个在 Vim 中使用计算器的功能用的就是表达式寄存器。

在插入模式下输入：

	<C-r>={需要计算的公式}<CR>
#### 9 其它只读寄存器 P.140
比较有用的是`"%`这个寄存器，它里面存储的是当前文件的文件名，
在普通模式下输入`"%p`可直接将文件名输出到当前光标处。

### Tip 61 用寄存器中的内容替换高亮选区中的文本 P.140

`p`命令通常都在普通模式下执行，在可视模式下，正如预想的那样，
它能将高亮显示的区域替换成指定寄存器中的内容。

本节有一个例子用来将下面一句话中的 'fish' 和 'chips' 互换位置

	I like fish and chips.
本例中综合使用了多个技巧，值得再看。

### Tip 62 把寄存器中的内容粘贴出来 `[g]p`, `[g]P`, `<C-r>"{register}`P.142
粘贴的内容分以字符为单位和以行为单位两种，这取决于存入寄存器时的格式。
以行为单位的内容用`p`或`P`粘贴很方便，以字符为单位的内容在插入模式下也可以用
`<C-r>"{register}`命令。

对行粘贴来说，`gp`, `gP` 也很有用，加上`g`前缀后，
可以将光标移动到新粘贴的行的末行，而默认的光标是在粘贴文本的首行。
在复制多行文本时，`gP`尤为管用。

### Tip 63 与系统剪贴板进行交互P.145
#### 1 为什么从外部应用程序往Vim中粘贴问题必须要用`Ctrl`-`Shift`-`v`？
本节指出了为什么在外部应用程序中（如浏览器）复制的文本粘贴到 Vim 
中为什么必须用`Ctrl`-`Shift`-`v`命令，因为`<C-v>`在普通模式下表示激活可视模式，
而在插入模式下，这个命令也有自己的定义：插入字符编码。

#### 2 粘贴多行代码缩进出错的解决方法
如果从外部程序中复制的文本是具有缩进的多行文本（如代码），
那么粘贴到 Vim 中后缩进将被打乱，一个解决方法是在`.vimrc`文件中加入如下设置：

	:set pastetoggle=<f5>
设置好后，在粘贴代码之前，先按下`F5`,再用`Ctrl`-`Shift`-`v`粘贴，
代码的缩进就正常了。

## Chapter 11 宏（Macros）P.148

> 就像黑白棋游戏一样，学会Vim的宏只需一分钟，但要穷其一生才能精通。

### Tip 64 宏的读取与执行`q{register}`, `q`, `@{register}`, `@@`, `{number}@{register}`
`q`既是录制按钮，也是停止按钮。开始录制时按`q{register}`,结束录制按`q`.
执行录制按`@{register}`,执行上一次宏按`@@`.

在命令序列中，一些奇怪的符号(P.167)：

- `^[`代表`Esc`键或`^[`。
- `<80>kb`: `Backspace`键；
- `^J`: 换行符；

宏的执行有多种方式，类似电路中的串并联，以”串行方式“执行的宏脆弱，
以”并行方式“执行的宏更健壮。
### Tip 65 规范光标位置、直达目标以及中止宏P.151
黄金法则：

> 在录制宏时，要确保每条命令都可被重复执行。

其他的要点：

1. **规范光标的位置**:用最具普遍性的命令来定位光标，
确保这条命令在任何情况下都管用。
2. **用可重复的动作命令直达目标** 推荐的光标定位方法有：查找命令、文本对象；
3. **当动作命令失败时，宏将中止执行** 以串联方式执行的宏常用此法。
### Tip 66 加次数回放宏P.153
将作者最推崇的“点范式”放进宏里执行可以进一步提高效率。

`11@q`表示将存在`"q`寄存器中的宏连续执行11次。注意这里的数字，
**不必精确，只要写个足够大的数字即可**。

### Tip 67 在连续的问本行上重复修改P.155
场景：我需要将下面一段文字

	1. one
	2. two
	3. three
	4. four
改成：

	1) One
	2) Two
	3) Three
	4) Four
这个问题的解决方法有很多，根据已有的知识，可以`:s`全局替换来将`.`换成`)`,
再用`:normal`命令或点范式将首字母大写。这里我们演示一下用宏如何完成。

类似`3@q`这样的属于“串联”形式，如果当中有一行注释，那么这个宏就会出问题。
使用`:normal [number]@{register}`的方法可以实现“并联”形式的执行，
这样即使中间某行出问题，也不影响后面的行的执行。

### Tip 68 给宏追加命令`q{REGISTER}`P.158
加入我们用`"a`来保存宏，当按下`qa`时，Vim将开始录制接下来的操作，
并将它们保存到`"a`寄存器中，这会覆盖`"a`寄存器中原有的内容。
如果将寄存器名称中的`a`改为大写，即输入`qA`，Vim同样会录制，
不过会将录制内容**追加**到`"a`寄存器中，而不是覆盖。

这可作为临时的补救措施，更好的方法是直接去编辑宏的内容，下面会讲到。

### Tip 69 在一组文件中执行宏P.160
需求例子：一些开源软件的源代码中，每个文件的头部都有一些版权信息，
如果逐个文件来添加，那效率太低了。这种情况下使用宏最合适不过了。

对多个文件执行宏组好用串联方式，因为若出现错误用并联方式很难发现错误。

### Tip 70 用迭代求值的方式给列表编号P.164
例子：如何将下面的文字

	kuixy
	andro.chen
	kuixy.chen
	trekshot
	chnkui
的每行前面加上列表序号1),2)等等。

本节开始使用基本的Vim脚本

### Tip 71 编辑宏的内容P.151
#### 1 将宏粘贴到文档`:put {register}`
#### 2 将宏从文档复制回寄存器
`"{register}`的确简单，但有可能在命令序列加上一个小尾巴，
最好使用面向字符的的复制，例如`0"ay$`,这条的命令的意思是：
先把光标移至命令序列行的开始，然后将从开头到结尾的内容复制到`"a`寄存器。
不用`"{register}p`的原因：`:put`永远都是行粘贴。

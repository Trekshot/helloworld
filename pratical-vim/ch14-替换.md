
## Chapter 14 替换（Substitute）
### Tip 87 结识substitute命令P.199
命令语法：

	:[range]s[ubstitute]/{pattern}/{string}/[flags]
要点：
- `[range]`的规则适用于所有 Ex 命令；
- 利用标志位（`[flags]`）调整 substitute 命令的行为：`:h s_flags`:
	- `g`: 在全局（准确地说，是“一整行”）范围执行替换；
	- `c`: 交互，每次替换前都询问；
	- `n`: 抑制正常的替换行为；
	- `e`: 屏蔽未找到模式的错误提示；
	- `&`: 让Vim重复使用上一次`:substitute`中用的标志位；
- `{string}`替换域中的特殊字符（完整列表参考`:h sub-replace-special`）

### Tip 88 在文件范围内查找并替换每一处匹配P.203
通常`g`标志位被理解为“全局”的意思，其实这里有误解，正确的理解是“一整行”。
`g`让替换以横轴方向扩展；`[range]`让替换以纵轴方向扩展。

### Tip 89 手动控制每一次替换操作P.205
`c`可以完成。这里说一下自己尚不知道的回复选项，目前只知道`y`,`n`，
其实还有很多，参考`:h :s_c`:

- `q`: 退出替换过程；
- `l`: "last", 替换此处匹配后直接退出
- `a`: "all", 替换此处与之后所有的匹配
- `<C-e>`: 向上滚动屏幕
- `<C-y>`: 向下滚动屏幕

注意：在Vim的替换-确认模式下，键盘上的大多数按键都将失效。

### Tip 90 重复使用上次的查找模式 P.206
将查找域留空，能让Vim自动使用上一次查找模式。

> 执行 substitute 命令通常包括两个步骤：一是撰写查找模式，
> 二是设计和是的替换字符串。因此，一分为二的技术让我们消除了这两项任务的耦合性，
> 这才是关键所在。

上面这段话指明了进行**复杂**替换操作时的正确方法：一分为二，

#### 养成在查找域中填充内容（`<C-r>/`）
将查找域留空确实省事，但也带来了一个问题：会在命令历史中留下一条不完整的记录。
举例来说，我们想把下面一个句子中的 google 替换成 `Google`:

	google is a outstanding company.
我们可以用`:.,.s/google/Google/g`来完成，
下面我们用上面将的一分为二的方法走一遍：
我们先执行查询`/google<CR>`,这样查询历史窗口中会新增一条记录:

	/google
接下来，我们使用`:.,.//Google/g`完成替换，这时命令行窗口也会新增一条记录：

	.,.s//Google/g
也就是说，

> 将查找任务与替换任务分离，会导致这两组信息被单独存放，
> 从而导致当你再想重用之前的 substitute 命令时，会遇到困难。

解决方法就是，不留空，但也不重新输入，而是用`<C-r>/`命令调出模式内容，
这样做不但在命令行窗口保存了完整的记录，同时快捷键的效率也还行。

### Tip 91 用寄存器内容替换P.199
上节讲的是查找模式偷懒的方式，本节讲讲替换模式如何“偷懒”。

#### 1 传值
如果替换域的内容刚好是某个寄存器中的内容，我们就可以通过`<C-r>{register}`
输出寄存器中的内容，例如，下面的命令将文件中的'find'替换成寄存器a中的内容：

	:%s/find/<C-r>a
这个命令有个问题：Tip 87 中讲到，替换域中有些特殊字符具有特殊含义。
如果寄存器中包含这些特殊字符的话，上面的命令就会出现问题。
引用寄存器可以避免上面的问题，但操作相对复杂，需要用到vim 脚本。


#### 2 引用寄存器`:%s//\=@{register}/g`
假设我们需要将下面一段话中的'google' 替换成'Google & Facebook':

	Google & Facebook
	I like google.
1. `/google<CR>`保存查询模式；
2. 将光标移至'G'处，然后`vfk"zy`将替换字符存入z寄存器；
3. `:%s//\=@z/g` 完成替换，注意特殊字符'&'也正确地显示出来；

替换域中如果出现`\=`,表示 vim 将执行一段表达式脚本。在脚本中，
我们可以用`@{register}`来引用某个寄存器中的内容。

### Tip 92 重复上一次 substitute命令 P.210

#### 1 在整个文件范围内重复面向行的替换操作`g&`
`g&` = `:%s//~/&` *repeat last substitute on all lines with the same flags*
次命令局限性很强，了解即可。

#### 2 修正 substitute 命令的执行范围
在可视模式下输入`:&&`命令，初读感觉作用不大。

### Tip 93 使用子匹配重排CSV文件的字段P.213
假设下面的CSV文件内容：

	last name, first name, email
	kui, chen, drodata@foxmail.com
	andro, chen, andro_chen@163.com
我们想交换这些字段的次序，让邮箱在第一列。

这个例子涉及到子匹配，初读未细看。

### Tip 94 在替换过程中执行算术运算 P.214
假设有下面的HTML代码：

	<h2>Chapter</h2>
	<h3>Section</h3>
	<h4>SubSection</h4>
我面想变成：

	<h1>Chapter</h1>
	<h2>Section</h2>
	<h3>SubSection</h3>
也就是说，将每个 Header 标签提高一个等级。本节介绍了方法。

### Tip 95 交换两个或更多的单词 P.216
未做笔记
### Tip 96 在多个文件中执行查找与替换 P.218
未做笔记
